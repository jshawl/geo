x-common: &common-config
  build:
    context: .
    target: builder
  volumes:
    - ./:/app/

services:
  worker:
    command: nimble run worker
    <<: *common-config

  server:
    command: nimble run server
    <<: *common-config

  test:
    <<: *common-config
    command: nimble test

  proxy:
    ports:
      - "9000:80"
